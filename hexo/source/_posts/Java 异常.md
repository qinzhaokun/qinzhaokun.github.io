---
title: Java 异常
date: 2017-9-27
taps: Java
categries: Java
---
异常表示的是不期而至的各种状况，如：文件找不到，网络连接失败，非法参数等，异常时一个事件，它发生在程序的运行期间。

Java中所有异常的祖先是`Throwable`,它有两个子类，分别是：`Exception`和`Error`，即异常和错误

## Error（错误）

这是**程序无法处理的错误**，表示运行应用程序中较严重问题。大多数错误与代码编写者执行的操作无关，而表示代码运行时 JVM（Java 虚拟机）出现的问题。这些错误表示故障发生于虚拟机自身、或者发生在虚拟机试图执行应用时。典型的有：

+ StackOverFlowError

+ OutOfMemoryError

+ NoClassDefFoundError

 ## Exception（异常）
 
这是程序本身可以处理的异常。Exception 类有一个重要的子类 `RuntimeException`。`RuntimeException` 类及其子类表示“JVM 常用操作”引发的错误。例如，若试图使用空值对象引用、除数为零或数组越界，则分别引发运行时异常（`NullPointerException`、`ArithmeticException`）和 `ArrayIndexOutOfBoundException`。

**异常和错误的区别：异常能被程序本身可以处理，错误是无法处理**

Java的异常(包括Exception和Error)分为*可查的异常（checked exceptions）*和*不可查的异常（unchecked exceptions）*

## 可查异常（编译器要求必须处置的异常）

正确的程序在运行中，很容易出现的、情理可容的异常状况。可查异常虽然是异常状况，但在一定程度上它的发生是可以预计的，而且一旦发生这种异常状况，就必须采取某种方式进行处理。

**除了RuntimeException及其子类以外，其他的Exception类及其子类都属于可查异常**。这种异常的特点是Java编译器会检查它，也就是说，当程序中可能出现这类异常，要么用try-catch语句捕获它，要么用throws子句声明抛出它，否则编译不会通过。

## 不可查异常(编译器不要求强制处置的异常)

包括运行时异常（RuntimeException与其子类）和错误（Error）。

Exception 这种异常分两大类运行时异常和非运行时异常(编译异常)。程序中应当尽可能去处理这些异常。

## 运行时异常

都是RuntimeException类及其子类异常，如NullPointerException(空指针异常)、IndexOutOfBoundsException(下标越界异常)等，这些异常是不检查异常，程序中可以选择捕获处理，也可以不处理。这些异常一般是由程序逻辑错误引起的，程序应该从逻辑角度尽可能避免这类异常的发生。

 运行时异常的特点是Java编译器不会检查它，也就是说，当程序中可能出现这类异常，即使没有用try-catch语句捕获它，也没有用throws子句声明抛出它，也会编译通过。
 
## 非运行时异常 （编译异常）

是RuntimeException以外的异常，类型上都属于Exception类及其子类。从程序语法角度讲是必须进行处理的异常，如果不处理，程序就不能编译通过。如IOException、SQLException等以及用户自定义的Exception异常，一般情况下不自定义检查异常。

## 异常运行机制

异常处理机制为：**抛出异常**，**捕捉异常**。

### 抛出异常

当一个方法出现错误引发异常时，方法创建异常对象并交付运行时系统，异常对象中包含了异常类型和异常出现时的程序状态等异常信息。运行时系统负责寻找处置异常的代码并执行。

### 捕获异常

在方法抛出异常之后，运行时系统将转为寻找合适的异常处理器（exception handler）。潜在的异常处理器是异常发生时依次存留在调用栈中的方法的集合。当异常处理器所能处理的异常类型与方法抛出的异常类型相符时，即为合适 的异常处理器。运行时系统从发生异常的方法开始，依次回查调用栈中的方法，直至找到含有合适异常处理器的方法并执行。当运行时系统遍历调用栈而未找到合适 的异常处理器，则运行时系统终止。同时，意味着Java程序的终止。

 对于*运行时异常、错误或可查异常*，Java技术所要求的异常处理方式有所不同。
 
+ 由于运行时异常的不可查性，为了更合理、更容易地实现应用程序，Java规定，**运行时异常将由Java运行时系统自动抛出**，允许应用程序忽略运行时异常。

+ 对于方法运行中可能出现的Error，当运行方法不欲捕捉时，**Java允许该方法不做任何抛出声明**。因为，大多数Error异常属于永远不能被允许发生的状况，也属于合理的应用程序不该捕捉的异常。

+ 对于所有的可查异常，Java规定：**一个方法必须捕捉，或者声明抛出方法之外**。也就是说，当一个方法选择不捕捉可查异常时，它必须声明将抛出异常。

## try catch finally语句

1. 当try没有捕获到异常时：try语句块中的语句逐一被执行，程序将跳过catch语句块，执行finally语句块和其后的语句；

2. 当try捕获到异常，catch语句块里没有处理此异常的情况：当try语句块里的某条语句出现异常时，而没有处理此异常的catch语句块时，此异常将会抛给JVM处理，**finally语句块里的语句还是会被执行**，但finally语句块后的语句不会被执行；

3. 当try捕获到异常，catch语句块里有处理此异常的情况：在try语句块中是按照顺序来执行的，当执行到某一条语句出现异常时，程序将跳到catch语句块，并与catch语句块逐一匹配，找到与之对应的处理程序，其他的catch语句块将不会被执行，而try语句块中，出现异常之后的语句也不会被执行，catch语句块执行完后，执行finally语句块里的语句，最后执行finally语句块后的语句

还有几点需要补充的就是try catch finally和return结合的情况。

**当try或catch里中有return语句时，finally还是会执行的，finally语句是在try的return语句执行之后，return返回之前执行**， 例如：

```
try{
  ...
  return test();
} catch (Exception e){

} finally{
  
}

```

在这里，先会执行test()函数，再执行finally，在返回test()的返回值。所以，顺序是**执行return语句，执行finally块，被后，返回return值**

**还有一点需要注意到是，不要在finally里return，如果这样的话，try里的return值就无法被返回了，finally中return后的代码也无法被执行**。
